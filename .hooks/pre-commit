#!/bin/sh

# Find the python virtual environment
# This assumes there is only 1 'pyvenv.cfg' under the project tree
venvdir="$(dirname $(find -name pyvenv.cfg))"
if [ "$venvdir" = '.' ]; then
    >2 echo pre-commit: could not find python virtual environment
    exit 1
fi

# Check python source code style
staged_files="$(git diff --staged --name-only | grep .py$)"
if [ -n "$staged_files" ]; then
    echo Running isort
    "$venvdir/bin/isort" --profile black --check-only $staged_files
    echo Running black
    "$venvdir/bin/black" --check $staged_files
fi

# TODO Add typescript style checking

